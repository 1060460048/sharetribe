<h1><%= @person.name(session[:cookie]) %></h1>

<div class="links_panel">
  <div class="left_float">
    <%= get_profile_navi_items(params[:id]) %>
  </div>
  <div class="right_float">
    <% unless @person.id == @current_user.id %>
      <%= link_to t(:send_message_to_user), send_message_person_path(@person) %>
    <% end %>  
  </div>  
</div>

<div id="profile_left">

  <div id="profile_picture">
    <%= large_avatar_thumb(@person) %>
  </div>
  
  <% if is_current_user?(@person) %>
  <div class="profile_left_link">
    <%= link_to t(:edit_profile_picture), "#" %>
  </div>  
  <div class="dashed_line"></div>
  <br />
  <% end %>

</div>  

<div id="profile_right">  

  <div class="profile_small_header">
    <div class="left_float">
      <b><%= t(:information) %></b>
    </div>
    <div class="right_float">
      <%= link_to t(:edit), edit_person_path(@person) if is_current_user?(@person) %>
    </div>
  </div>
  
  <div class="profile_info">
  <% if @editing %>
    <% form_for @person, :url => person_path(@person), :method => :put do |f| %>
    <div class="profile_info_field">
      <div class="profile_update_form_left">
        <%= t(:otasizzle_username) %>:
      </div>
      <div class="profile_update_form_center">
        <%= @person.username %>
      </div>
    </div>
    <div class="profile_info_field">  
      <div class="profile_update_form_left">
        <%= t(:email) %>:
      </div>
      <div class="profile_update_form_center">
        <%= @person.email %> <%= link_to("edit", "#") %>
      </div>
    </div>
    <div class="profile_info_field">
      <div class="profile_update_form_left">
        <%= t(:given_name) %>:
      </div>
      <div class="profile_update_form_right">
        <%= f.text_field :given_name, :size => 34 %>
      </div>
    </div>
    <div class="profile_info_field">
      <div class="profile_update_form_left">
        <%= t(:family_name) %>:
      </div>
      <div class="profile_update_form_right">
        <%= f.text_field :family_name, :size => 34 %>
      </div>
    </div>
    <div class="profile_info_field">  
      <div class="profile_update_form_left">
        <%= t(:address) %>:
      </div>
      <div class="profile_update_form_right">
        <%= f.text_field :address, :size => 34 %>
      </div>
    </div>
    <div class="profile_info_field">  
      <div class="profile_update_form_left">
        <%= t(:phone_number) %>:
      </div>
      <div class="profile_update_form_right">
        <%= f.text_field :phone_number, :size => 34 %>
      </div>
    </div>
    <div class="profile_update_form_buttons">
      <%= submit_tag t(:save), :onclick => "this.disabled=true,this.form.submit();" %>
      <%= submit_tag t(:cancel), :name => "person[cancel]" %>
    </div>  
    <% end %>
  <% else %>
    <div class="profile_info_field">
      <b><%= t(:otasizzle_username)%>:</b> <%= @person.username(session[:cookie]) %>
    </div>
    <% unless (@person.address == nil || @person.address.eql?("")) && @person.id != @current_user.id %>
    <div class="dashed_line"></div>
    <div class="profile_info_field">  
      <b><%= t(:address)%>:</b> <%= @person.address %>
    </div>
    <% end %>
    <% unless (@person.phone_number == nil || @person.phone_number.eql?("")) && @person.id != @current_user.id %>
    <div class="dashed_line"></div>
    <div class="profile_info_field">    
      <b><%= t(:phone_number)%>:</b> <%= @person.phone_number %>
    </div>
    <% end %>
  <% end %>
  </div>
  
  <div class="profile_small_header">
    <b><%= t(:items_i_can_lend) %></b>
  </div>
  
  <div class="profile_info">
    <% if @items.size > 0 %>
      <%= render :partial => "people/profile_items", :collection => @items, :as => :item, :spacer_template => "layouts/dashed_line" %>
    <% else %>
      <div class="profile_info_field"><%= t(:no_items)%></div>
    <% end %>
  </div>
  
  <% if @person.id == @current_user.id %>
  
  <div class="profile_add_form">
  
  <% form_for :item, :url => items_path do |f| %>
    <%= f.text_field :title, :size => 40 %> &nbsp;&nbsp;
    <%= f.hidden_field :owner_id, :value => @current_user.id %>
    <%= submit_tag t(:add_new_item), :onclick => "this.disabled=true,this.form.submit();" %>
  <% end %>
  
  </div>
  
  <% end %>
  
  <div class="profile_small_header">
    <b><%= t(:favors_i_can_do) %></b>
  </div>
  
  <div class="profile_info">
    <% if @favors.size > 0 %>
      <%= render :partial => "people/profile_favors", :collection => @favors, :as => :favor, :spacer_template => "layouts/dashed_line" %>
    <% else %>
      <div class="profile_info_field"><%= t(:no_favors)%></div>
    <% end %>
  </div>
  
  <% if @person.id == @current_user.id %>
  
  <div class="profile_add_form">
  
  <% form_for :favor, :url => favors_path do |f| %>
    <%= f.text_field :title, :size => 40 %> &nbsp;&nbsp;
    <%= f.hidden_field :owner_id, :value => @current_user.id %>
    <%= submit_tag t(:add_new_favor), :onclick => "this.disabled=true,this.form.submit();" %><br />
  <% end %>
  
  </div>

  <% end %>

</div>

<% if (@person.received_comments.size > 0) %>
  <div id="comments">
    <h4><%= t(:comments) %> (<%= @person.received_comments.size.to_s %>) </h4>
    <%= render :partial => "people/person_comment", 
               :collection => @person.received_comments, 
               :as => :comment, 
               :spacer_template => "layouts/dashed_line" %>
  </div>
<% end %>