<% if @items.size > 1 %>
  <h1><%= t(:borrow) + " " + t(:items_partitive) + " " + t(:from_user) + " " + @person.name %></h1>
<% else %>
  <h1><%= t(:borrow) + " " + h(@items.first.title).downcase + " " + t(:from_user) + " " + @person.name %></h1>
<% end %>

<p><%= link_to t(:view_other_items_from_this_user), person_path(@person) + "#items" %>

<% item_string = @items.collect { |item| h(item.title) }.join(", ") %>  

<% form_for @conversation, :url => person_inbox_index_path(@current_user) do |f| %>
  <% if @conversation.errors.size > 0 %>
    <br />
    <%= f.error_messages %>
  <% end %>  
  <%= hidden_field_tag  "conversation[title]", t(:i_want_to_borrow_this_item) + ": " + truncate(item_string, :omission => "...", :length => 80) %>
  <%= hidden_field_tag "conversation[type]", "Reservation" %>
  <%= hidden_field_tag "conversation[status]", "pending_owner" %>
  <%= hidden_field_tag "conversation[conversation_participants][]", @person.id %>
  <%= hidden_field_tag "conversation[conversation_participants][]", @current_user.id %>
  <%= hidden_field_tag "receiver", params[:receiver] %>
  <%= hidden_field_tag "return_to", params[:return_to] %>

  <%= render :partial => "reservations/edit_reservation_details" %>

  <div id="basic_content">
    <div class="form_container">
    <% fields_for "conversation[message_attributes]", Message.new do |message_form| -%>
      <div class="form_header">
        <%= t(:free_message) %>:
      </div>
      <div class="form_field">
        <%= message_form.text_area :content, :class => "message", :value => params[:conversation] ? params[:conversation][:message_attributes][:content] : t(:hi_i_would_like_to_borrow_these_items) %>
      </div>
      <%= message_form.hidden_field :sender_id, :value => @current_user.id %>
    <% end %>
    </div>
    <div class="form_container">
      <div class="form_right">
        <%= submit_tag t(:make_reservation_request), :onclick => "this.disabled=true,this.form.submit();" %>
      </div>
    </div>
  </div>

<% end %>